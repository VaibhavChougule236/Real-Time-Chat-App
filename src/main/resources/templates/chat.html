<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Real-Time Chat Room</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<style>
	body {
		background: #f5f7fa;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	#chat {
		height: 400px;
		overflow-y: auto;
		background: #ffffff;
		border-radius: 10px;
		padding: 15px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}
	.message {
		padding: 8px 12px;
		margin-bottom: 10px;
		border-radius: 8px;
		max-width: 75%;
		word-wrap: break-word;
	}
	.message.self {
		background: #0d6efd;
		color: white;
		margin-left: auto;
	}
	.message.other {
		background: #e9ecef;
		color: #333;
		margin-right: auto;
	}
	.input-group input {
		border-radius: 30px;
	}
	#sendMessage {
		border-radius: 30px;
		padding: 0 20px;
	}
</style>
</head>
<body>
	<div class="container py-4">
		<div class="card shadow-lg border-0 rounded-4">
			<div class="card-header bg-primary text-white text-center rounded-top-4">
				<h3 class="mb-0">ðŸ’¬ Real-Time Chat Room</h3>
			</div>

			<div class="card-body">
				<div id="chat"></div>
			</div>

			<div class="card-footer bg-light">
				<div class="row g-2">
					<div class="col-md-3">
						<input id="senderInput" type="text" class="form-control"
							placeholder="Your Name..." />
					</div>
					<div class="col-md-7">
						<input id="messageInput" type="text" class="form-control"
							placeholder="Type a message..." />
					</div>
					<div class="col-md-2 d-grid">
						<button class="btn btn-primary" id="sendMessage">Send</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		function setConnected(connected) {
			document.getElementById('sendMessage').disabled = !connected;
		}

		function connect() {
			var socket = new SockJS('/chat');
			stompClient = Stomp.over(socket);
			stompClient.connect({}, function(frame) {
				console.log("Connected: " + frame);
				setConnected(true);
				stompClient.subscribe('/topic/messages', function(message) {
					const parsed = JSON.parse(message.body);
					showMessage(parsed);
				});
			});
		}

		function showMessage(message) {
			const chat = document.getElementById('chat');
			const messageElement = document.createElement('div');

			// Different style if sender matches your name
			const sender = document.getElementById('senderInput').value.trim();
			if (message.sender === sender) {
				messageElement.className = "message self";
			} else {
				messageElement.className = "message other";
			}

			messageElement.textContent = message.sender + ": " + message.content;
			chat.appendChild(messageElement);
			chat.scrollTop = chat.scrollHeight;
		}

		function sendMessage() {
			var sender = document.getElementById('senderInput').value;
			var content = document.getElementById('messageInput').value;
			if (!sender || !content) return;

			var chatMessage = {
				sender : sender,
				content : content
			};

			stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
			document.getElementById('messageInput').value = '';
		}

		document.getElementById('sendMessage').onclick = sendMessage;
		window.onload = connect;
	</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
		crossorigin="anonymous"></script>
</body>
</html>
